---
#This is the final screen for the migration path and forces docassemble to run the Migration questions
event: M_final_screen
question: Thank you for using the MSM Online Client Intake Form
subquestion: |
  Thank you for using the MSM Online Client Intake Form!
  
  Your responses are shown in the table below.
  
  - If you have made a mistake, click the **Restart** button to fix the mistake.
  
  - If you are satisfied with the information you have provided, click **Submit and Exit** and you will be contacted as soon as possible to organise an appointment time with a member of the MSM Legal team. A copy of your responses will also be sent to the email address you have provided.
  
    Questions|Main Applicant's Details
    ---------------|-------------
    %if is_user_main_applicant == 'Yes':
    Full Name | ${ migration_user_first_name } ${ migration_user_last_name }
    Date of Birth | ${ format_date(migration_user_DOB, format='dd mmmm yyyy')}
    Email Address | ${ migration_user_email_address }
    Current Address | ${ migration_user_address } ${ migration_user_city } ${ migration_user_state } ${ migration_user_postcode }
    Country | ${ country_name(migration_user_country) }
    Phone Number | ${ migration_user_phone_number }
    Passport Country | ${ country_name(migration_user_passport) }
    Family Members Migrating | ${ migration_user_family_members }
    Current Australian Visa | ${ migration_user_aus_visa }
    Visa Type | ${ migration_user_visa_type }
    Date of Expiry | ${ format_date(migration_user_visa_expiry, format=' dd mmmm yyyy') }
    Purpose of stay in Australia | ${ migration_user_reason_stay }
    %elif is_user_main_applicant == 'No':
    Full Name | ${ migration_main_app_first_name } ${ migration_main_app_last_name }
    Date of Birth | ${ format_date(migration_main_app_DOB, format='dd mmmm yyyy') }
    Email Address | ${ migration_main_app_email_address }
    Address | ${ migration_main_app_address } ${ migration_main_app_city } ${ migration_main_app_state } ${ migration_main_app_postcode }
    Country | ${ country_name(migration_main_app_country) }
    Phone Number | ${ migration_main_app_phone_number }
    Passport Country | ${ country_name(migration_main_app_passport) }
    Migrating Family Members | ${ migration_main_app_family_members }
    Current Australian Visa | ${ migration_main_app_aus_visa }
    Visa Type | ${ migration_main_app_visa_type }
    Date of Expiry | ${ format_date(migration_main_app_visa_expiry, format=' dd mmmm yyyy') }
    Purpose of stay in Australia | ${ migration_main_app_reason_stay }
    %endif
  
    %if is_user_main_applicant == 'No':
    Questions|Your Details
    ------------|-------------
    Full Name | ${ migration_user_first_name } ${ migration_user_last_name }
    Email Address | ${ migration_user_email_address } 
    Phone Number | ${ migration_user_phone_number }
    Relationship to Main Applicant | ${ user_relationship_with_main_app }
    %endif
    
    Questions|Your Matter
    ------------|-------------
    Purpose of Enquiry | ${ migration_enquiry_purpose.true_values() } { migration_other_purpose }
    You Would Like To See | ${ MSM_fee_earner }
    Appointment Type | ${ appointment_type }

  % if migration_email_sent_ok:
  Once again, thank you for contacting MSM Legal, and we look forward to speaking with you soon. 
  % else:
  There was a problem sending the e-mail.
  % endif
buttons:
  - Submit and Exit: exit
    url: https://www.msmlegal.com.au/
  - Restart: restart
---
#This is the first question of the migration path - asks if the user is the main applicant
question: Are you the Main Applicant?
subquestion: |
field: is_user_main_applicant
buttons:
  - 'Yes'
  - 'No'
---
#If user is the Main Applicant this screen shall ask if there are any family members applying/migrating with them - this is where the loop may come in handy
question: Family Members
subquestion: |
  Do you have any **family members** who will be migrating with you?
field: migration_user_family_members
buttons:
  - "Yes"
  - "No"
---
#If user is NOT the Main Applicant this screen shall ask if there are any family members applying/migrating with the Main Applicant - this is where the loop may come in handy
question: Family Members
subquestion: |
  Does the Main Applicant have any **family members** who will be migrating with them?
field: migration_main_app_family_members
buttons:
  - "Yes"
  - "No"
---
#If there are family members, this screen will ask for their details (including visa status and purpose in Australia)
---
#If the user is the main applicant this will ask for their personal details 
question: Please fill out your details below.
subquestion: |
fields:
  - First Name: migration_user_first_name
  - Last Name: migration_user_last_name
  - Date of Birth: migration_user_DOB
    datatype: date
    required: False
  - Email Address: migration_user_email_address
    datatype: email
  - Current Address: migration_user_address
    required: False
  - City: migration_user_city
    required: False
  - State/Province: migration_user_state
    required: False
  - Postcode/Zip: migration_user_postcode
    required: False
  - Country: migration_user_country
    code: countries_list()
    default: AU
    required: True
  - Is the best contact phone number based in Australia?: migration_user_phone_international
    datatype: noyesradio
    default: False
  - What country is associated with the best contact phone number?: migration_user_phone_country
    code: countries_list()
    show if: migration_user_phone_international
  - What is the best contact phone number?: migration_user_phone_number
---
#This code sets the default country for phone numbers 
code: |
  if not migration_user_phone_international:
    migration_user_phone_country = 'Aus'
---
#This code block sends the email to the user for the migration path
code: |
  migration_email_sent_ok = send_email(to=migration_user_email_address,bcc=['shai.barboza@flinders.edu.au'], template=migration_notification, attachments=[MSM_Legal_Answer_Template_Migration])
---
#This is the email template for the migration path email that the user will recieve
template: migration_notification
subject: |
  MSM Legal Client Intake Form for ${ migration_user_first_name } ${ migration_user_last_name }.
content: |
  Hello ${ migration_user_first_name } ${ migration_user_last_name }, 
  
  Thank you for contacting MSM Legal regarding your matter. We have received your enquiry and one of our team members will be in touch shortly.
  
  For your reference, please find attached a copy of what we have recieved.
  
  Should you have any questions or concerns, please do not hesitate to contact us on (08) 81615088 or via email at dh@msmlegal.com.au
  
  Kind Regards, 
  
  MSM Legal
---
#This is the code which attaches the pdf to the email the user recieves
attachment: 
  - name: legal answers 
    filename: ${ migration_user_first_name } ${ migration_user_last_name } Answers
    variable name: MSM_Legal_Answer_Template_Migration
    description: | 
      contains the answers entered by the user
    docx template file: MSM_Legal_Answer_Template_Migration.docx
    valid formats: 
      - pdf
---
#This will ask the user for the country of issue for their passport - it is separate from the rest of the information so it will not be asked if the user is NOT the Main Applicant
question: Main Applicant's Passport Information
subquestion: |
fields:
  - Passport Country of Issue: migration_user_passport
    code: countries_list()
    default: AU
    required: True
---
#If User is NOT the main applicant then this screen will ask for their relationship to the MA
question: What is your relationship to the Main Applicant?
fields: 
  - Relationship: user_relationship_with_main_app 
    required: False
---
# These questions are asked if the user is NOT the main applicant
question:  Please fill out the Main Applicant's personal information below.
subquestion: |
fields:
  - The Main Applicant's First Name: migration_main_app_first_name
  - The Main Applicant's Last Name: migration_main_app_last_name
  - The Main Applicant's Date of Birth: migration_main_app_DOB
    datatype: date
    required: False
  - The Main Applicant's Email Address: migration_main_app_email_address
    datatype: email
    required: False
  - The Main Applicant's Current Address: migration_main_app_address
    required: False
  - City: migration_main_app_city
    required: False
  - State/Province: migration_main_app_state
    required: False
  - Postcode/Zip: migration_main_app_postcode
    required: False
  - Country: migration_main_app_country
    code: countries_list()
    default: AU
    required: False
  - Is the best contact mobile based in Australia?: migration_main_app_phone_international
    datatype: noyesradio
    default: False
  - What country is associated with the best contact phone number?: migration_main_app_phone_country
    code: countries_list()
    show if: migration_main_app_phone_international
  - What is the best contact phone number?: migration_main_app_phone_number
  - Passport Country of Issue: migration_main_app_passport
    code: countries_list()
    default: AU
    required: True
---
#If the user is NOT the Main Applicant this asks for the Main Applicant's Visa Details
question: Main Applicant's Visa Details
subquestion: |
  Please fill out the Main Applicant's Visa Details information below.
fields:
  - Does the Main Applicant hold a Current Australian Visa?: migration_main_app_aus_visa
    datatype: radio
    choices:
      - Yes
      - No
# NEED ASSISTANCE - If Main Applicant holds a Current Australian Visa then these questions:
  - What is the type of Visa held by the Main Applicant?: migration_main_app_visa_type
    datatype: area
  - When does the Main Applicant's Current Australian Visa expire?: migration_main_app_visa_expiry
    datatype: date
# NEED ASSISTANCE - If Main Applicant does NOT hold a Current Australian Visa then ask:
  - What is the main purpose of the Main Applicant's stay in Australia?: migration_main_app_reason_stay
    datatype: area
---
#If the user is the Main Applicant this asks for their Visa Details
question: Your Visa Details
subquestion: |
  Please fill out your Visa Details below.
fields:
  - Do you hold a Current Australian Visa?: migration_user_aus_visa
    datatype: radio
    choices:
      - Yes
      - No
# NEED ASSISTANCE - If user holds a Current Australian Visa then these questions:
  - What type of Visa do you currently hold?: migration_user_visa_type
    datatype: area
  - When does your Current Australian Visa expire?: migration_user_visa_expiry
    datatype: date
# NEED ASSISTANCE - If user does NOT hold a Current Australian Visa then ask:
  - What is the main purpose of your stay in Australia?: migration_user_reason_stay
    datatype: area
---
# This asks what legal issue/s the Main Applicant is seeking advice for 
question: Purpose of enquiry 
subquestion: |
  Which best describes the main issue you are seeking advice for.
fields:
  - Purpose of Enquiry: migration_enquiry_purpose
    datatype: checkboxes
    choices:
      - To apply for permanent pathway
      - To extend my current stay
      - To bring family members to Australia
      - Issues with current visa (character, breach of visa condition etc)
      - Visa refusal
      - Visa cancellation
      - Citizenship
      - Other
    none of the above: False
  - If Other, please describe: migration_other_purpose
    datatype: area
    required: False
# ASSISTANCE NEEDED - how do I make this required if the person selects Other or use a show if
#  - Other issue: legal_issue
#    datatype: area
# ASSISTANCE NEEDED - need help with the show if 
#    show if:
#      variable: legal_issue
#      is: Other
---
#This question gives migration users the option to choose which fee earner they would like to see
question: Which lawyer/migration agent you would like to see?
subquestion: |
  Please select a lawyer/migration agent you would like to see and we will do our best to match you with them OR let MSM assign someone to your matter.
fields:
  - MSM Staff: MSM_fee_earner
    datatype: radio
    choices:
    - Catherine Follett
    - Mitchell Simmons
    - Zainab Al-Sweedy
    - Mark Sekerin
    - Let MSM assign someone
---
# This question will ask what appointment type the user would like to book.
Question: What type of appointment would you prefer?
subquestion: |
  Please select an appointment type.
fields:
  - Appointment Type: appointment_type
    datatype: radio
    choices:
    - In person
    - Virtual (Zoom)
---