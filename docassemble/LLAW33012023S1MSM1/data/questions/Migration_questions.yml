---
#This will run the Migration questions
event: M_final_screen
question: Thank you for using the MSM Online Client Intake Form
subquestion: |
  Thank you for using the MSM Online Client Intake Form!
  
  Your responses are shown in the table below.
  
  - If you have made a mistake, click the **Restart** button to fix the mistake.
  
  - If you are satisfied with the information you have provided, click **Submit and Exit** and you will be contacted as soon as possible to organise an appointment time with a member of the MSM Legal team. A copy of your responses will also be sent to the email address you have provided.
  
    | Questions|Main Applicant's Details |
    | ---------------|------------- |
    %if userMainApp == 'Yes':
    | Full Name | ${ user_first_name } ${ user_last_name } |
    | Date of Birth | ${ user_DOB } |
    | Email Address | ${ Muser_email_address } |
    | Current Address | ${ user_address } ${ user_city } ${ user_state } ${ user_postcode } |
    | Country | ${ country_name(user_country) } |
    | Phone Number | ${ user_phone_number } |
    | Passport Country | ${ country_name(user_passport) } |
    | Family Members Migrating | ${ userMA_family_members } |
    | Current Australian Visa | ${ user_aus_visa } |
    | Visa Type | ${ user_visa_type } |
    | Date of Expiry | ${ user_visa_expiry } |
    | Purpose of stay in Australia | ${ user_reason_stay } |
    %elif userMainApp == 'No':
    | Full Name | ${ Main_app_first_name } ${ Main_app_last_name } |
    | Date of Birth | ${ Main_app_DOB } |
    | Email Address | ${ Main_app_email_address } |
    | Address | ${ Main_app_address } ${ Main_app_city } ${ Main_app_state } ${ Main_app_postcode } |
    | Country | ${ country_name(Main_app_country) } |
    | Phone Number | ${ Main_app_phone_number } |
    | Passport Country | ${ country_name(Main_app_passport) } |
    | Migrating Family Members | ${ Main_app_family_members } |
    | Current Australian Visa | ${ Main_app_aus_visa } |
    | Visa Type | ${ Main_app_visa_type } |
    | Date of Expiry | ${ Main_app_visa_expiry } |
    | Purpose of stay in Australia | ${ Main_app_reason_stay } |
    %endif
  
    %if userMainApp == 'No':
    | Questions|Your Details |
    | ------------|------------- |
    | Full Name | ${ user_first_name } ${ user_last_name } |
    | Email Address | ${ Muser_email_address } |
    | Phone Number | ${ user_phone_number } |
    | Relationship to Main Applicant | ${ user_relationship } |
    %endif
    
    | Questions|Your Matter |
    | ------------|------------- |
    | Purpose of Enquiry | ${ enquiry_purpose.true_values() } { other_purpose } |
    | You Would Like To See | ${ MSM_fee_earner } |
    |  Appointment Type | ${ appointment_type } |

  % if M_email_sent_ok:
  Once again, thank you for contacting MSM Legal, and we look forward to speaking with you soon. 
  % else:
  There was a problem sending the e-mail.
  % endif
buttons:
  - Submit and Exit: exit
    url: https://www.msmlegal.com.au/
  - Restart: restart
---
#This is the first question of the migration path - asks if the user is the main applicant
question: Are you the Main Applicant?
subquestion: |
field: userMainApp
buttons:
  - 'Yes'
  - 'No'
---
#If user is the Main Applicant this screen shall ask if there are any family members applying/migrating with them - this is where the loop may come in handy
question: Family Members
subquestion: |
  Do you have any **family members** who will be migrating with you?
field: userMA_family_members
buttons:
  - "Yes"
  - "No"
---
#If user is NOT the Main Applicant this screen shall ask if there are any family members applying/migrating with the Main Applicant - this is where the loop may come in handy
question: Family Members
subquestion: |
  Does the Main Applicant have any **family members** who will be migrating with them?
field: Main_app_family_members
buttons:
  - "Yes"
  - "No"
---
#If there are family members, this screen will ask for their details (including visa status and purpose in Australia)
---
question: Please fill out your details below.
subquestion: |
fields:
  - First Name: user_first_name
  - Last Name: user_last_name
  - Date of Birth: user_DOB
    datatype: date
    required: False
  - Email Address: Muser_email_address
    datatype: email
  - Current Address: user_address
    required: False
  - City: user_city
    required: False
  - State/Province: user_state
    required: False
  - Postcode/Zip: user_postcode
    required: False
  - Country: user_country
    code: countries_list()
    default: AU
    required: False
  - Is the best contact phone number based in Australia?: user_phone_international
    datatype: noyesradio
    default: False
  - What country is associated with the best contact phone number?: user_phone_country
    code: countries_list()
    show if: user_phone_international
  - What is the best contact phone number?: user_phone_number
### Hashed out as MSM don't need the verification
###validation code: |
###  if user_phone_international:
###    if not phone_number_is_valid(user_phone_number, country=user_phone_country):
###      validation_error('Please enter a valid phone number for ' + country_name(user_phone_country) + '.', field='user_phone_number')
###  else:
###    if not phone_number_is_valid(user_phone_number):
###      validation_error('Please enter a valid phone number.', field='user_phone_number')
---
code: |
  if not user_phone_international:
    user_phone_country = 'Aus'
---
code: |
  M_email_sent_ok = send_email(to=Muser_email_address,bcc=['shai.barboza@flinders.edu.au'], template=M_notification, attachments=[MSM_Legal_Answer_Template_Migration])
---
template: M_notification
subject: |
  MSM Legal Client Intake Form for ${ user_first_name } ${ user_last_name }.
content: |
  Hello ${ user_first_name } ${ user_last_name }, 
  
  Thank you for contacting MSM Legal regarding your matter. We have received your enquiry and one of our team members will be in touch shortly.
  
  For your reference, please find attached a copy of what we have recieved.
  
  Should you have any questions or concerns, please do not hesitate to contact us on (08) 81615088 or via email at dh@msmlegal.com.au
  
  Kind Regards, 
  
  MSM Legal
---
attachment: 
  - name: legal answers 
    filename: ${ user_first_name } ${ user_last_name } Answers
    variable name: MSM_Legal_Answer_Template_Migration
    description: | 
      contains the answers entered by the user
    docx template file: MSM_Legal_Answer_Template_Migration.docx
    valid formats: 
      - pdf
---
#This will ask the user for the country of issue for their passport - it is separate from the rest of the information so it will not be asked if the user is NOT the Main Applicant
question: Main Applicant's Passport Information
subquestion: |
fields:
  - Passport Country of Issue: user_passport
    code: countries_list()
    required: False
---
#If User is NOT the main applicant then this screen will ask for their relationship to the MA
question: What is your relationship to the Main Applicant?
fields: 
  - Relationship: user_relationship 
    required: False
---
question:  Please fill out the Main Applicant's personal information below.
subquestion: |
fields:
  - The Main Applicant's First Name: Main_app_first_name
  - The Main Applicant's Last Name: Main_app_last_name
  - The Main Applicant's Date of Birth: Main_app_DOB
    datatype: date
    required: False
  - The Main Applicant's Email Address: Main_app_email_address
    datatype: email
    required: False
  - The Main Applicant's Current Address: Main_app_address
    required: False
  - City: Main_app_city
    required: False
  - State/Province: Main_app_state
    required: False
  - Postcode/Zip: Main_app_postcode
    required: False
  - Country: Main_app_country
    code: countries_list()
    default: AU
    required: False
  - Is the best contact mobile based in Australia?: Main_app_phone_international
    datatype: noyesradio
    default: False
  - What country is associated with the best contact phone number?: Main_app_phone_country
    code: countries_list()
    show if: Main_app_phone_international
  - What is the best contact phone number?: Main_app_phone_number
  - Passport Country of Issue: Main_app_passport
    code: countries_list()
    required: False
### Hashed out as MSM don't need the verification
###validation code: |
###  if Main_app_phone_international:
###    if not phone_number_is_valid(Main_app_phone_number, country=Main_app_phone_country):
###      validation_error('Please enter a valid phone number for ' + country_name(Main_app_phone_country) + '.', field='Main_app_phone_number')
###  else:
###    if not phone_number_is_valid(Main_app_phone_number):
###      validation_error('Please enter a valid phone number.', field='Main_app_phone_number')
---
#If the user is NOT the Main Applicant this asks for the Main Applicant's Visa Details
question: Main Applicant's Visa Details
subquestion: |
  Please fill out the Main Applicant's Visa Details information below.
fields:
  - Does the Main Applicant hold a Current Australian Visa?: Main_app_aus_visa
    datatype: radio
    choices:
      - Yes
      - No
# NEED ASSISTANCE - If Main Applicant holds a Current Australian Visa then these questions:
  - What is the type of Visa held by the Main Applicant?: Main_app_visa_type
    datatype: area
  - When does the Main Applicant's Current Australian Visa expire?: Main_app_visa_expiry
    datatype: date
# NEED ASSISTANCE - If Main Applicant does NOT hold a Current Australian Visa then ask:
  - What is the main purpose of the Main Applicant's stay in Australia?: Main_app_reason_stay
    datatype: area
---
#If the user is the Main Applicant this asks for their Visa Details
question: Your Visa Details
subquestion: |
  Please fill out your Visa Details below.
fields:
  - Do you hold a Current Australian Visa?: user_aus_visa
    datatype: radio
    choices:
      - Yes
      - No
# NEED ASSISTANCE - If user holds a Current Australian Visa then these questions:
  - What type of Visa do you currently hold?: user_visa_type
    datatype: area
  - When does your Current Australian Visa expire?: user_visa_expiry
    datatype: date
# NEED ASSISTANCE - If user does NOT hold a Current Australian Visa then ask:
  - What is the main purpose of your stay in Australia?: user_reason_stay
    datatype: area
---
# This asks what legal issue/s the Main Applicant is seeking advise for 
question: Purpose of enquiry 
subquestion: |
  Which best describes the main issue you are seeking advise for.
fields:
  - Purpose of Enquiry: enquiry_purpose
    datatype: checkboxes
    choices:
      - To apply for permanent pathway
      - To extend my current stay
      - To bring family members to Australia
      - Issues with current visa (character, breach of visa condition etc)
      - Visa refusal
      - Visa cancellation
      - Citizenship
      - Other
    none of the above: False
  - If Other, please describe: other_purpose
    datatype: area
    required: False
# ASSISTANCE NEEDED - how do I make this required if the person selects Other or use a show if
#  - Other issue: legal_issue
#    datatype: area
# ASSISTANCE NEEDED - need help with the show if 
#    show if:
#      variable: legal_issue
#      is: Other
---
question: Which lawyer/migration agent you would like to see?
subquestion: |
  Please select a lawyer/migration agent you would like to see and we will do our best to match you with them OR let MSM assign someone to your matter.
fields:
  - MSM Staff: MSM_fee_earner
    datatype: radio
    choices:
    - Catherine Follett
    - Mitchell Simmons
    - Zainab Al-Sweedy
    - Mark Sekerin
    - Let MSM assign someone
---
# This question will ask what appointment type the user would like to book.
Question: What type of appointment would you prefer?
subquestion: |
  Please select an appointment type.
fields:
  - Appointment Type: appointment_type
    datatype: radio
    choices:
    - In person
    - Virtual (Zoom)
---